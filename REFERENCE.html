<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Thoroughbred Basic Reference Manual</title>
    <style>
        :root {
            --primary-color: #2c3e50;
            --accent-color: #3498db;
            --text-color: #333;
            --code-bg: #f8f9fa;
            --sidebar-width: 250px;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            line-height: 1.6;
            color: var(--text-color);
            margin: 0;
            display: flex;
        }

        /* Sidebar Navigation */
        nav {
            width: var(--sidebar-width);
            height: 100vh;
            background: #f4f4f4;
            position: fixed;
            overflow-y: auto;
            padding: 20px;
            border-right: 1px solid #ddd;
        }

        nav h3 {
            margin-top: 0;
            color: var(--primary-color);
        }

        nav ul {
            list-style: none;
            padding: 0;
        }

        nav li {
            margin-bottom: 5px;
        }

        nav a {
            text-decoration: none;
            color: #666;
            transition: color 0.2s;
        }

        nav a:hover {
            color: var(--accent-color);
        }

        /* Main Content */
        main {
            margin-left: var(--sidebar-width);
            padding: 40px;
            max-width: 900px;
            width: 100%;
        }

        h1, h2, h3 {
            color: var(--primary-color);
        }

        h1 { border-bottom: 2px solid var(--accent-color); padding-bottom: 10px; }
        h2 { border-bottom: 1px solid #ddd; padding-bottom: 5px; margin-top: 40px; }
        h3 { margin-top: 30px; color: var(--accent-color); }

        code {
            background: var(--code-bg);
            padding: 2px 5px;
            border-radius: 3px;
            font-family: "SFMono-Regular", Consolas, "Liberation Mono", Menlo, Courier, monospace;
            font-size: 0.9em;
            color: #d63384;
        }

        pre {
            background: var(--code-bg);
            padding: 15px;
            border-radius: 5px;
            overflow-x: auto;
            border: 1px solid #eee;
        }

        pre code {
            color: inherit;
            background: none;
            padding: 0;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }

        th, td {
            border: 1px solid #ddd;
            padding: 12px;
            text-align: left;
        }

        th {
            background-color: #f8f9fa;
        }

        .syntax {
            font-weight: bold;
            color: #555;
            background: #eef;
            padding: 5px 10px;
            display: inline-block;
            border-radius: 4px;
            margin-bottom: 10px;
        }

        .section-link {
            display: block;
            margin-top: -80px;
            padding-top: 80px;
            visibility: hidden;
        }
    </style>
</head>
<body>

<nav>
    <h3>Contents</h3>
    <ul>
        <li><a href="#config">Configuration</a></li>
        <li><a href="#a">A</a></li>
        <li><a href="#c">C</a></li>
        <li><a href="#d">D</a></li>
        <li><a href="#e">E</a></li>
        <li><a href="#f">F</a></li>
        <li><a href="#g">G</a></li>
        <li><a href="#h">H</a></li>
        <li><a href="#i">I</a></li>
        <li><a href="#l">L</a></li>
        <li><a href="#m">M</a></li>
        <li><a href="#n">N</a></li>
        <li><a href="#o">O</a></li>
        <li><a href="#p">P</a></li>
        <li><a href="#r">R</a></li>
        <li><a href="#s">S</a></li>
        <li><a href="#t">T</a></li>
        <li><a href="#u">U</a></li>
        <li><a href="#v">V</a></li>
        <li><a href="#x">X</a></li>
        <li><a href="#w">W</a></li>
        <li><a href="#mnemonics">Terminal Mnemonics</a></li>
    </ul>
</nav>

<main>
    <h1>Thoroughbred Basic Interpreter <br><small>Reference Manual</small></h1>
    <p>This manual contains an alphabetical overview of all implemented commands (directives) and functions in this interpreter.</p>

    <h2 id="config">Configuration and Disks</h2>
    <p>The interpreter supports the <strong>Thoroughbred Basic 'Disk' concept</strong>. This maps logical disk numbers to physical directories.</p>

    <h3>IPLINPUT</h3>
    <p>On startup, the interpreter reads the configuration file <code>IPLINPUT</code> from the current working directory.</p>
    <strong>Format:</strong>
    <pre><code>D0 = ./data/d0
D1 = ./data/backup
DA = /var/thoroughbred/data</code></pre>
    <ul>
        <li>Each disk name starts with <code>D</code>, followed by 1 character (digit or letter).</li>
        <li>Paths can be relative or absolute.</li>
    </ul>

    <h3>File Searching</h3>
    <p>When opening a file (<code>OPEN</code>), the interpreter searches for the file in the defined disks in <strong>alphabetical order</strong> of the disk name (e.g., first <code>D0</code>, then <code>D1</code>, then <code>DA</code>...), unless a specific path is provided.</p>

    <h3>Creating Files</h3>
    <p>For commands like <code>DIRECT</code>, <code>INDEXED</code>, <code>SERIAL</code>, and <code>SORT</code>, a disk number can be specified to determine where the file is created.</p>

    <h2 id="a">A</h2>
    
    <h3>ABS</h3>
    <div class="syntax">ABS(num)</div>
    <p>Returns the absolute value of a number.</p>
    <ul><li><code>ABS(-5)</code> &rarr; <code>5</code></li></ul>

    <h3>ASC</h3>
    <div class="syntax">ASC(string)</div>
    <p>Returns the ASCII value of the first character of the string.</p>
    <ul><li><code>ASC("A")</code> &rarr; <code>65</code></li></ul>

    <h3>ATH</h3>
    <div class="syntax">ATH(string)</div>
    <p>(ASCII to Hex) Converts a hexadecimal string to a binary string (bytes). If length is odd, a '0' is prepended.</p>
    <ul><li><code>ATH("41")</code> &rarr; <code>"A"</code></li></ul>

    <h3>ATN</h3>
    <div class="syntax">ATN(num)</div>
    <p>Returns the arctangent of a number (in radians).</p>

    <h2 id="c">C</h2>

    <h3>CALL</h3>
    <div class="syntax">CALL "program", [ERR=line], [args...]</div>
    <p>Calls an external sub-program with optional arguments. Starts a new interpreter context.</p>

    <h3>CHR$</h3>
    <div class="syntax">CHR$(code)</div>
    <p>Returns the character corresponding to the ASCII code.</p>

    <h3>CLOSE</h3>
    <div class="syntax">CLOSE (channel)</div>
    <p>Closes an open file channel and flushes changes to disk.</p>

    <h3>COS</h3>
    <div class="syntax">COS(num)</div>
    <p>Returns the cosine of an angle (in radians).</p>

    <h3>CVS</h3>
    <div class="syntax">CVS(string, mode)</div>
    <p>Converts/manipulates a string based on mode bits:</p>
    <ul>
        <li>1: Strip leading spaces</li>
        <li>2: Strip trailing spaces</li>
        <li>16: To Uppercase</li>
        <li>32: To Lowercase</li>
    </ul>

    <h2 id="d">D</h2>

    <h3>DIM</h3>
    <div class="syntax">DIM var[size](len), ...</div>
    <p>Defines arrays or reserves memory for string arrays.</p>

    <h3>DIRECT</h3>
    <div class="syntax">DIRECT "filename", key_len, rec_len, disk_num, sector_num</div>
    <p>Creates a new DIRECT file (Keyed). <code>disk_num</code> specifies the target disk.</p>

    <h3>DTN</h3>
    <div class="syntax">DTN(string [, mask])</div>
    <p>Converts a date string to a numeric Julian Day Number.</p>

    <h2 id="e">E</h2>

    <h3>END</h3>
    <div class="syntax">END</div>
    <p>Terminates program execution and closes all files.</p>

    <h3>ENDTRACE</h3>
    <div class="syntax">ENDTRACE</div>
    <p>Stops the trace mode started by <code>SETTRACE</code>.</p>

    <h3>ENTER</h3>
    <div class="syntax">ENTER var1, var2...</div>
    <p>Used in a <code>CALL</code>ed program to receive arguments.</p>

    <h3>ERASE</h3>
    <div class="syntax">ERASE "filename"</div>
    <p>Permanently removes a file from disk.</p>

    <h3>EXECUTE</h3>
    <div class="syntax">EXECUTE string_expr [, OPT="LOCAL"]</div>
    <p>Dynamically executes BASIC code. Can modify the running program.</p>

    <h3>EXIT</h3>
    <div class="syntax">EXIT</div>
    <p>Exits a sub-program and returns to the caller.</p>

    <h3>EXP</h3>
    <div class="syntax">EXP(num)</div>
    <p>Returns <code>e</code> to the power of <code>num</code>.</p>

    <h3>EXTRACT / EXTRACTRECORD</h3>
    <div class="syntax">EXTRACT (chn, KEY=k) ...</div>
    <p>Reads a record and locks it for updates. Does <strong>not</strong> advance the file pointer.</p>

    <h2 id="f">F</h2>

    <h3>FOR</h3>
    <div class="syntax">FOR var = start TO end [STEP step]</div>
    <p>Starts a loop.</p>

    <h3>FPT</h3>
    <div class="syntax">FPT(num)</div>
    <p>Returns the fractional part of a number.</p>

    <h2 id="g">G</h2>

    <h3>GOSUB</h3>
    <div class="syntax">GOSUB line</div>
    <p>Jumps to a subroutine. Return with <code>RETURN</code>.</p>

    <h3>GOTO</h3>
    <div class="syntax">GOTO line</div>
    <p>Unconditional jump to a line number.</p>

    <h2 id="h">H</h2>

    <h3>HTA</h3>
    <div class="syntax">HTA(string)</div>
    <p>(Hex to ASCII) Converts a string to its hexadecimal representation.</p>

    <h2 id="i">I</h2>

    <h3>IF</h3>
    <div class="syntax">IF condition THEN line/stmt</div>
    <p>Conditional logic.</p>

    <h3>INDEXED</h3>
    <div class="syntax">INDEXED "filename", ...</div>
    <p>Creates an INDEXED file.</p>

    <h3>INPUT</h3>
    <div class="syntax">INPUT "Prompt: ", var</div>
    <p>Requests user input.</p>

    <h3>INT</h3>
    <div class="syntax">INT(num)</div>
    <p>Returns the floor of a number (largest integer <= num).</p>

    <h3>IOLIST</h3>
    <div class="syntax">line IOLIST item [, item ...]</div>
    <p>Defines a reusable list of variables/formatters for I/O statements.</p>
    <strong>Items:</strong> Variables, Mnemonics, Cursor <code>@(c,r)</code>, Literals.
    <br><strong>Usage:</strong> <code>READ (1, IOL=100)</code>

    <h3>IPT</h3>
    <div class="syntax">IPT(num)</div>
    <p>Returns the integer part (truncation) of a number.</p>

    <h2 id="l">L</h2>

    <h3>KEY</h3>
    <div class="syntax">KEY(channel [, ERR=ln, END=ln])</div>
    <p>Returns the key of the <strong>next</strong> record in a DIRECT/SORT file.</p>

    <h3>LCS</h3>
    <div class="syntax">LCS(string)</div>
    <p>Converts string to Lowercase.</p>

    <h3>LEN</h3>
    <div class="syntax">LEN(string)</div>
    <p>Returns the length of a string.</p>

    <h3>LET</h3>
    <div class="syntax">LET var = expr</div>
    <p>Assigns a value. The keyword <code>LET</code> is optional.</p>

    <h3>LOG</h3>
    <div class="syntax">LOG(num)</div>
    <p>Returns the natural logarithm.</p>

    <h2 id="m">M</h2>

    <h3>MAX</h3>
    <div class="syntax">MAX(item1, item2...)</div>
    <p>Returns the largest value.</p>

    <h3>MIN</h3>
    <div class="syntax">MIN(item1, item2...)</div>
    <p>Returns the smallest value.</p>

    <h3>MOD</h3>
    <div class="syntax">MOD(num, div)</div>
    <p>Returns the remainder of division.</p>

    <h2 id="n">N</h2>

    <h3>NEXT</h3>
    <div class="syntax">NEXT var</div>
    <p>Closes a <code>FOR</code> loop.</p>

    <h3>NOT</h3>
    <div class="syntax">NOT(string)</div>
    <p>Bitwise NOT inversion of string characters.</p>

    <h3>NUM</h3>
    <div class="syntax">NUM(str [, options])</div>
    <p>Converts string to number with formatting options.</p>

    <h2 id="o">O</h2>

    <h3>ON ... GOTO / GOSUB</h3>
    <div class="syntax">ON val GOTO line1, line2...</div>
    <p>Coumpount/Conditional jump based on integer index.</p>

    <h3>OPEN</h3>
    <div class="syntax">OPEN (chn) "filename"</div>
    <p>Opens a file on a channel.</p>

    <h3>OR</h3>
    <div class="syntax">OR(str1, str2)</div>
    <p>Bitwise OR of string characters.</p>

    <h2 id="p">P</h2>

    <h3>POS</h3>
    <div class="syntax">POS(haystack, needle) / POS(relation)</div>
    <p>Finds position of a substring or matching condition.</p>

    <h3>PRINT</h3>
    <div class="syntax">PRINT expr...</div>
    <p>Outputs text to console.</p>

    <h2 id="r">R</h2>

    <h3>READ</h3>
    <div class="syntax">READ (chn, KEY=k) vars...</div>
    <p>Reads data from a file. Advances file pointer.</p>

    <h3>REM</h3>
    <div class="syntax">REM comment</div>
    <p>Comment line.</p>

    <h3>REMOVE</h3>
    <div class="syntax">REMOVE (chn [, KEY=k])</div>
    <p>Deletes a record from a file.</p>

    <h3>RETURN</h3>
    <div class="syntax">RETURN</div>
    <p>Returns from a subroutine.</p>

    <h3>RND</h3>
    <div class="syntax">RND([seed])</div>
    <p>Returns random number between 0 and 1.</p>

    <h3>ROUND</h3>
    <div class="syntax">ROUND(num, decimals)</div>
    <p>Rounds a number.</p>

    <h2 id="s">S</h2>

    <h3>SELECT</h3>
    <div class="syntax">SELECT (chn) ...</div>
    <p>Selects records (Partial implementation).</p>

    <h3>SERIAL</h3>
    <div class="syntax">SERIAL "name", ...</div>
    <p>Creates a SERIAL file.</p>

    <h3>SETTRACE</h3>
    <div class="syntax">SETTRACE [(chn)]</div>
    <p>Enables debug tracing.</p>

    <h3>SGN</h3>
    <div class="syntax">SGN(num)</div>
    <p>Returns sign (-1, 0, 1) of number.</p>

    <h3>SIN</h3>
    <div class="syntax">SIN(num)</div>
    <p>Sine function.</p>

    <h3>SORT</h3>
    <div class="syntax">SORT "name", ...</div>
    <p>Creates a SORT file.</p>

    <h3>SQR</h3>
    <div class="syntax">SQR(num)</div>
    <p>Square root.</p>

    <h3>STOP</h3>
    <div class="syntax">STOP</div>
    <p>Halts execution.</p>

    <h3>STR$</h3>
    <div class="syntax">STR$(num)</div>
    <p>Converts number to string.</p>

    <h2 id="t">T</h2>

    <h3>TAN</h3>
    <div class="syntax">TAN(num)</div>
    <p>Tangent function.</p>

    <h2 id="u">U</h2>

    <h3>UCS</h3>
    <div class="syntax">UCS(string)</div>
    <p>Converts string to Uppercase.</p>

    <h2 id="v">V</h2>

    <h3>VAL</h3>
    <div class="syntax">VAL(string)</div>
    <p>Converts string to number.</p>

    <h2 id="x">X</h2>

    <h3>XOR</h3>
    <div class="syntax">XOR(str1, str2)</div>
    <p>Bitwise XOR of strings.</p>

    <h2 id="w">W</h2>

    <h3>WRITE</h3>
    <div class="syntax">WRITE (chn, KEY=k, IND=i) vars...</div>
    <p>Writes data to a file. Overwrites if key exists.</p>

    <h2 id="mnemonics">Terminal Mnemonics</h2>
    <p>Supported mnemonics for <code>PRINT</code> statements:</p>

    <table>
        <thead>
            <tr><th>Mnemonic</th><th>Function</th><th>Effect</th></tr>
        </thead>
        <tbody>
            <tr><td><code>'CS'</code></td><td>Clear Screen</td><td>Clears screen, moves cursor to top-left.</td></tr>
            <tr><td><code>'BR'</code></td><td>Begin Reverse</td><td>Starts reverse video.</td></tr>
            <tr><td><code>'ER'</code></td><td>End Reverse</td><td>Stops reverse video.</td></tr>
            <tr><td><code>'BU'</code></td><td>Begin Underline</td><td>Starts underline.</td></tr>
            <tr><td><code>'EU'</code></td><td>End Underline</td><td>Stops underline.</td></tr>
            <tr><td><code>'VT'</code></td><td>Vertical Tab</td><td>Cursor Up.</td></tr>
            <tr><td><code>'LF'</code></td><td>Line Feed</td><td>Cursor Down.</td></tr>
            <tr><td><code>'BS'</code></td><td>Backspace</td><td>Cursor Left.</td></tr>
            <tr><td><code>'CH'</code></td><td>Cursor Home</td><td>Moves cursor to top-left (no clear).</td></tr>
            <tr><td><code>'CE'</code></td><td>Clear to EOS</td><td>Clears to end of screen.</td></tr>
            <tr><td><code>'CL'</code></td><td>Clear to EOL</td><td>Clears to end of line.</td></tr>
            <tr><td><code>'LD'</code></td><td>Line Delete</td><td>Deletes current line.</td></tr>
            <tr><td><code>'@'(c,r)</code></td><td>Cursor Pos</td><td>Moves cursor to column c, row r.</td></tr>
        </tbody>
    </table>

</main>
</body>
</html>
